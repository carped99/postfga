version: 3

vars:
  # 전체 이미지 이름 (레지스트리 포함 가능)
  # 사용 시: task build-runtime IMAGE=registry.example.com/hhi/postfga RUNTIME_TAG=1.0.0
  IMAGE_NAME: '{{.IMAGE_NAME | default "gaia3d/postfga"}}'
  IMAGE_TAG: '{{.IMAGE_TAG | default "latest"}}'

  # dev / runtime 태그 기본값
  DEV_TAG: '{{.DEV_TAG | default "dev"}}'

  # docker compose 환경변수 파일 (dev / prod 전환용)
  ENV_FILE: '{{.ENV_FILE | default ".env.dev"}}'

tasks:
  build:
    desc: Build the release Docker image
    cmds:
      - |
        echo "==> Building runtime image: {{.IMAGE_NAME}}:{{.IMAGE_TAG}}"
        docker build \
          -f "{{.TASKFILE_DIR}}/Dockerfile" \
          --target runtime \
          -t {{.IMAGE_NAME}}:{{.IMAGE_TAG}} \
          .